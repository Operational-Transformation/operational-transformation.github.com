(this["webpackJsonpot-demo"]=this["webpackJsonpot-demo"]||[]).push([[0],{101:function(e,t,n){},102:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(12),c=n.n(i),l=n(4),s=n(8),p=n(38),u=n(10),m=n(6);function E(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function f(){return"".concat(E()).concat(E(),"-").concat(E(),"-").concat(E(),"-").concat(E(),"-").concat(E()).concat(E()).concat(E())}!function(e){e.Alice="Alice",e.Bob="Bob"}(a||(a={}));var d,O,v=function(e,t){return{base:e,transformedAgainst:[],meta:{author:t,id:f()}}},h=function(e,t,n){var a=e(t.base,n.base),r=Object(l.a)(a,2),o=r[0],i=r[1];return[{base:o,transformedAgainst:[].concat(Object(m.a)(t.transformedAgainst),[n.meta.id]),meta:t.meta},{base:i,transformedAgainst:[].concat(Object(m.a)(n.transformedAgainst),[t.meta.id]),meta:n.meta,revision:n.revision+1}]},g=function(e,t,n){if(0!==t.transformedAgainst.length)throw new Error("you shouldn't compose a transformed operation because composition and transformation are not compatible");return{meta:{author:t.meta.author,id:f()},transformedAgainst:[],revision:t.revision,base:e(t.base,n)}};!function(e){e.SYNCHRONIZED="SYNCHRONIZED",e.AWAITING_OPERATION="AWAITING_OPERATION",e.AWAITING_OPERATION_WITH_BUFFER="AWAITING_OPERATION_WITH_BUFFER"}(d||(d={})),function(e){e.USER_EDIT_IMMEDIATELY_SENT_TO_SERVER="USER_EDIT_IMMEDIATELY_SENT_TO_SERVER",e.USER_EDIT_STORED_AS_BUFFER="USER_EDIT_STORED_AS_BUFFER",e.USER_EDIT_ADDED_TO_BUFFER="USER_EDIT_ADDED_TO_BUFFER",e.RECEIVED_OWN_OPERATION="RECEIVED_OWN_OPERATION",e.RECEIVED_OWN_OPERATION_AND_SENT_BUFFER="RECEIVED_OWN_OPERATION_AND_SENT_BUFFER",e.RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED="RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED",e.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION="RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION",e.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER="RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER"}(O||(O={}));function b(e){var t=e.clientLog,n=e.initialSynchronizationState;return t.length>0?t[0].newState:n}function I(e,t,n,a){var r=t.initialSynchronizationState,o=t.clientLog,i=t.toServer,c=t.fromServer,l=t.snapshot,s=function(e,t,n,a){switch(t.status){case d.SYNCHRONIZED:var r=t.serverRevision,o=Object(u.a)(Object(u.a)({},v(n,a)),{},{revision:r});return{newSynchronizationState:{status:d.AWAITING_OPERATION,awaitedOperation:o},operationsToSendToServer:[o],newClientLogEntry:{type:O.USER_EDIT_IMMEDIATELY_SENT_TO_SERVER,operation:o}};case d.AWAITING_OPERATION:var i=t.awaitedOperation.revision+1,c=Object(u.a)(Object(u.a)({},v(n,a)),{},{revision:i});return{newSynchronizationState:{status:d.AWAITING_OPERATION_WITH_BUFFER,awaitedOperation:t.awaitedOperation,buffer:c},operationsToSendToServer:[],newClientLogEntry:{type:O.USER_EDIT_STORED_AS_BUFFER,operation:c}};case d.AWAITING_OPERATION_WITH_BUFFER:return{newSynchronizationState:{status:d.AWAITING_OPERATION_WITH_BUFFER,awaitedOperation:t.awaitedOperation,buffer:g(e,t.buffer,n)},operationsToSendToServer:[],newClientLogEntry:{type:O.USER_EDIT_ADDED_TO_BUFFER,base:n}}}}(e.compose,b(t),n,a),p=s.newSynchronizationState,E=s.operationsToSendToServer;return{clientLog:[{entry:s.newClientLogEntry,newState:p}].concat(Object(m.a)(o)),toServer:[].concat(Object(m.a)(i),Object(m.a)(E)),fromServer:c,snapshot:e.apply(n,l),initialSynchronizationState:r}}function R(e,t){return Object(u.a)(Object(u.a)({},e),{},{fromServer:[].concat(Object(m.a)(e.fromServer),[t])})}function T(e,t,n){var a=n.get(t),r=Object(p.a)(a.toServer),o=r[0],i=r.slice(1),c=Object(u.a)(Object(u.a)({},a),{},{toServer:i}),l=n.set(t,c),s=function(e,t,n){var a=t.operations.slice(n.revision).reduce((function(t,n){return h(e.transform,n,t)[1]}),n);return{operationToBroadcast:a,newServerState:{operations:[].concat(Object(m.a)(t.operations),[a]),snapshot:e.apply(a.base,t.snapshot)}}}(e,l.server,o),E=s.newServerState,f=s.operationToBroadcast;return{server:E,alice:R(l.alice,f),bob:R(l.bob,f)}}function S(e,t){var n=t.initialSynchronizationState,a=t.clientLog,r=t.fromServer,o=t.toServer,i=t.snapshot,c=Object(p.a)(r),s=c[0],u=c.slice(1),E=function(e,t,n){switch(t.status){case d.SYNCHRONIZED:return{newSynchronizationState:{status:d.SYNCHRONIZED,serverRevision:t.serverRevision+1},operationToSendToServer:void 0,transformedReceivedOperationToApply:n,newClientLogEntry:{type:O.RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED,receivedOperation:n}};case d.AWAITING_OPERATION:var a=t.awaitedOperation;if(n.meta.id===a.meta.id)return{newSynchronizationState:{status:d.SYNCHRONIZED,serverRevision:a.revision+1},operationToSendToServer:void 0,transformedReceivedOperationToApply:void 0,newClientLogEntry:{type:O.RECEIVED_OWN_OPERATION,acknowledgedOperation:n}};var r=h(e,n,a),o=Object(l.a)(r,2),i=o[0],c=o[1];return{newSynchronizationState:{status:d.AWAITING_OPERATION,awaitedOperation:c},operationToSendToServer:void 0,transformedReceivedOperationToApply:i,newClientLogEntry:{type:O.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION,receivedOperation:n,transformedReceivedOperation:i,awaitedOperation:a,transformedAwaitedOperation:c}};case d.AWAITING_OPERATION_WITH_BUFFER:var s=t.awaitedOperation,p=t.buffer;if(n.meta.id===s.meta.id)return{newSynchronizationState:{status:d.AWAITING_OPERATION,awaitedOperation:t.buffer},operationToSendToServer:t.buffer,transformedReceivedOperationToApply:void 0,newClientLogEntry:{type:O.RECEIVED_OWN_OPERATION_AND_SENT_BUFFER,acknowledgedOperation:n,sentBuffer:t.buffer}};var u=h(e,n,s),m=Object(l.a)(u,2),E=m[0],f=m[1],v=h(e,E,p),g=Object(l.a)(v,2),b=g[0],I=g[1];return{newSynchronizationState:{status:d.AWAITING_OPERATION_WITH_BUFFER,awaitedOperation:f,buffer:I},operationToSendToServer:void 0,transformedReceivedOperationToApply:b,newClientLogEntry:{type:O.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER,receivedOperation:n,onceTransformedReceivedOperation:E,twiceTransformedReceivedOperation:b,awaitedOperation:s,transformedAwaitedOperation:f,bufferOperation:p,transformedBufferOperation:I}}}}(e.transform,b(t),s),f=E.newSynchronizationState,v=E.operationToSendToServer,g=E.transformedReceivedOperationToApply,I=E.newClientLogEntry;return{newClientState:{snapshot:void 0===g?i:e.apply(g.base,i),toServer:void 0===v?o:[].concat(Object(m.a)(o),[v]),fromServer:u,clientLog:[{entry:I,newState:f}].concat(Object(m.a)(a)),initialSynchronizationState:n},transformedReceivedOperationToApply:g}}var _,N=n(7),y=Object(s.a)({site:{background:"#eee",padding:"20px",margin:"0 15px","& h2":{margin:"0 0 16px","& svg":{margin:"0 12px 0 4px",verticalAlign:"bottom"}}}}),A=function(e){switch(e){case a.Alice:return"#0074D9";case a.Bob:return"#e2451e"}},w=n(122),x=n(121),j=n(64),C=n.n(j),D=n(65),P=n.n(D),W=n(66),F=n.n(W),L=n(67),k=n.n(L),U=function(e){var t=e.start,n=e.end,a=e.shaftWidth,r=e.tipLength,i=e.tipWidth,c=e.color,l=n.x-t.x,s=n.y-t.y,p=Math.sqrt(l*l+s*s),u=(i-a)/2,m=p-r;return o.a.createElement("path",{fill:c,transform:"matrix(".concat(l/p,", ").concat(s/p,", ").concat(-s/p,", ").concat(l/p,", ").concat(t.x,", ").concat(t.y,")"),d:"m ".concat(p,",0 -").concat(r,",-").concat(i/2," 0,").concat(u," -").concat(m,",0 0,").concat(a," ").concat(m,",0 0,").concat(u," z")})},B={shaftWidth:10,tipLength:24,tipWidth:20},H=function(e,t,n){return{x:(1-e)*t.x+e*n.x,y:(1-e)*t.y+e*n.y}},z=Object(s.a)({synchronizationState:{lineHeight:"24px",background:"#eee",padding:"12px 20px"},synchronizationStateOperation:{margin:"0 2px",verticalAlign:"-4px"},stateLabel:{color:"#666"}}),V=function(e){return function(t){var n=t.synchronizationState,a=z(),r=o.a.createElement("span",{className:a.stateLabel},"State:");switch(n.status){case d.SYNCHRONIZED:return o.a.createElement("p",{className:a.synchronizationState},r," Synchronized at server revision ",n.serverRevision);case d.AWAITING_OPERATION:return o.a.createElement("p",{className:a.synchronizationState},r," Awaiting operation"," ",o.a.createElement(e,{operation:n.awaitedOperation,className:a.synchronizationStateOperation}));case d.AWAITING_OPERATION_WITH_BUFFER:return o.a.createElement("p",{className:a.synchronizationState},r," Awaiting operation"," ",o.a.createElement(e,{operation:n.awaitedOperation,className:a.synchronizationStateOperation})," ","with buffer"," ",o.a.createElement(e,{operation:n.buffer,className:a.synchronizationStateOperation}))}}},M=n(72),G=Object(r.createContext)([void 0,function(){throw new Error("you need to wrap this with <OperationHoverProvider />")}]),Y=function(e){var t=Object(r.useState)(void 0);return o.a.createElement(G.Provider,{value:t},e.children)},Z=Object(s.a)({operation:{display:"inline-block",width:"20px",height:"20px",borderRadius:"10px"},tooltip:{"&$tooltip":{fontSize:"13px"}}}),q=function(e,t){return e.meta.id===t.meta.id},$=function(e){switch(e){case 1:return"transformation";case 2:return"two transformations";case 3:return"three transformations";case 4:return"four transformations";case 5:return"five transformations";case 6:return"six transformations";case 7:return"seven transformations";case 8:return"eight transformations";case 9:return"nine transformations";default:return"multiple transformations"}},J=function(e,t){if(function(e,t){for(var n=Math.min(e.length,t.length),a=0;a<n;a++)if(e[a]!==t[a])return!1;return!0}(e.transformedAgainst,t.transformedAgainst)){var n=e.transformedAgainst.length-t.transformedAgainst.length;return n<0?"before ".concat($(-n)):n>0?"after ".concat($(n)):"identical"}return"differently transformed"};!function(e){e.Closed="CLOSED",e.Closing="CLOSING",e.Open="OPEN"}(_||(_={}));var X,K=function(e){return function(t){var n=Z(),a=(t.className,t.style),i=t.operation,c=t.tooltipPlacement,s=Object(M.a)(t,["className","style","operation","tooltipPlacement"]),p=Object(r.useState)(""),m=Object(l.a)(p,2),E=m[0],f=m[1],d=Object(r.useState)(_.Closed),O=Object(l.a)(d,2),v=O[0],h=O[1],g=Object(r.useContext)(G),b=Object(l.a)(g,2),I=b[0],R=b[1];Object(r.useEffect)((function(){v===_.Closed&&void 0!==I&&q(I,i)?f(J(i,I)):v===_.Closing&&void 0===I&&h(_.Closed)}),[v,I,i]);var T=Object(r.useCallback)((function(){h(_.Open),f(function(e,t){return o.a.createElement(o.a.Fragment,null,void 0!==t.revision?o.a.createElement("p",{style:{textAlign:"center",fontWeight:"bold"}},"Revision: ",t.revision):o.a.createElement(o.a.Fragment,null),o.a.createElement("div",null,e(t.base)))}(e.renderOperation,i)),R(i)}),[i,R]),S=Object(r.useCallback)((function(){h(I?_.Closing:_.Closed),R(void 0)}),[I,R]),y=void 0!==I&&q(i,I);return o.a.createElement(x.a,{key:i.meta.id,arrow:!0,classes:{tooltip:n.tooltip},title:E,open:v===_.Open||y,placement:null!==c&&void 0!==c?c:"bottom",onOpen:T,onClose:S},o.a.createElement("span",Object.assign({key:i.meta.id,className:Object(N.a)(n.operation,t.className),style:Object(u.a)({background:A(i.meta.author)},a)},s)))}},Q=Object(s.a)({clientLog:{margin:"0 15px 20px",lineHeight:"24px"},clientLogItem:{transition:"margin 0.5s ease, height 0.5s ease",overflow:"hidden",position:"relative","& > div":{position:"absolute",left:"0",right:"0",bottom:"0"}},clientLogEntry:{padding:"12px 20px 12px 40px"},inlineOperation:{margin:"0 2px",verticalAlign:"-4px"}}),ee=function(e){var t=K(e),n=V(t),a=function(e){return function(t){var n=t.width,a=t.height,r=t.arrows;return o.a.createElement("div",{style:{position:"relative",width:"".concat(n,"px"),height:"".concat(a,"px"),margin:"0 auto"}},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:a,style:{position:"absolute",opacity:"0.2"}},r.map((function(e,t){var n=e.operation,a=e.start,r=e.end;return o.a.createElement(U,Object.assign({key:t,start:H(.1,a,r),end:H(.95,a,r),color:A(n.meta.author)},B))}))),r.map((function(t,n){var a=t.operation,r=t.start,i=t.end,c=t.tooltipPlacement,l=H(.45,r,i),s={position:"absolute",left:"".concat(l.x-10,"px"),top:"".concat(l.y-10,"px")};return o.a.createElement(e,{key:n,operation:a,tooltipPlacement:c,style:s})})))}}(t),i=function(e){var n=Q();return o.a.createElement("p",null,"User edit"," ",o.a.createElement(t,{className:n.inlineOperation,operation:e.operation})," ","was sent to the server.")},c=function(e){var n=Q();return o.a.createElement("p",null,"User edit"," ",o.a.createElement(t,{className:n.inlineOperation,operation:e.operation})," ","was stored in buffer.")},s=function(e){return o.a.createElement("p",null,"Added user edit to buffer.")},p=function(e){var n=Q();return o.a.createElement("p",null,"Received acknowledgment of own operation"," ",o.a.createElement(t,{className:n.inlineOperation,operation:e.acknowledgedOperation}),".")},u=function(e){var n=Q();return o.a.createElement("p",null,"Received acknowledgment of own operation"," ",o.a.createElement(t,{className:n.inlineOperation,operation:e.acknowledgedOperation})," ","and sent buffer"," ",o.a.createElement(t,{className:n.inlineOperation,operation:e.sentBuffer}),".")},m=function(e){var n=Q();return o.a.createElement("p",null,"Received operation"," ",o.a.createElement(t,{className:n.inlineOperation,operation:e.receivedOperation})," ","from the server and immediately applied it to the document.")},E=function(e){var n=e.receivedOperation,r=e.transformedReceivedOperation,i=e.awaitedOperation,c=e.transformedAwaitedOperation,l=Q(),s={x:20,y:15},p={x:125,y:20},u={x:15,y:120},m={x:120,y:125},E=[{operation:i,start:s,end:p,tooltipPlacement:"top"},{operation:c,start:u,end:m,tooltipPlacement:"bottom"},{operation:n,start:s,end:u,tooltipPlacement:"left"},{operation:r,start:p,end:m,tooltipPlacement:"right"}];return o.a.createElement(o.a.Fragment,null,o.a.createElement(a,{width:140,height:140,arrows:E}),o.a.createElement("p",{style:{marginTop:"4px"}},"Transformed received operation"," ",o.a.createElement(t,{className:l.inlineOperation,operation:n})," ","against the awaited transformation"," ",o.a.createElement(t,{className:l.inlineOperation,operation:i})," ","resulting in"," ",o.a.createElement(t,{className:l.inlineOperation,operation:r})," ","(applied to the editor) and a new awaited operation"," ",o.a.createElement(t,{className:l.inlineOperation,operation:c}),"."))},f=function(e){var n=e.receivedOperation,r=e.onceTransformedReceivedOperation,i=e.twiceTransformedReceivedOperation,c=e.awaitedOperation,l=e.transformedAwaitedOperation,s=e.bufferOperation,p=e.transformedBufferOperation,u=Q(),m={x:20,y:15},E={x:125,y:20},f={x:230,y:25},d={x:15,y:120},O={x:120,y:125},v={x:225,y:130},h=[{operation:c,start:m,end:E,tooltipPlacement:"top"},{operation:l,start:d,end:O,tooltipPlacement:"bottom"},{operation:s,start:E,end:f,tooltipPlacement:"top"},{operation:p,start:O,end:v,tooltipPlacement:"bottom"},{operation:n,start:m,end:d,tooltipPlacement:"left"},{operation:r,start:E,end:O,tooltipPlacement:"bottom"},{operation:i,start:f,end:v,tooltipPlacement:"right"}];return o.a.createElement(o.a.Fragment,null,o.a.createElement(a,{width:245,height:145,arrows:h}),o.a.createElement("p",{style:{marginTop:"4px"}},"Transformed received operation"," ",o.a.createElement(t,{className:u.inlineOperation,operation:n})," ","first against the awaited transformation"," ",o.a.createElement(t,{className:u.inlineOperation,operation:c})," ","and then against the buffer"," ",o.a.createElement(t,{className:u.inlineOperation,operation:s})," ","resulting in"," ",o.a.createElement(t,{className:u.inlineOperation,operation:i})," ","(applied to the editor), a new awaited operation"," ",o.a.createElement(t,{className:u.inlineOperation,operation:l})," ","and a new buffer"," ",o.a.createElement(t,{className:u.inlineOperation,operation:p}),"."))};return function(e){var t=e.entry,a=e.newState,d=Q(),v=Object(r.useState)(void 0),h=Object(l.a)(v,2),g=h[0],b=h[1],I=Object(r.useCallback)((function(e){var t=e.getBoundingClientRect();b(t.height)}),[]);return o.a.createElement("div",{className:d.clientLogItem,style:void 0===g?{height:"1px",margin:"-100px 0 100px"}:{height:"".concat(g,"px"),margin:"0"}},o.a.createElement("div",{ref:I},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:null!==g&&void 0!==g?g:"0",style:{position:"absolute",zIndex:-1}},o.a.createElement(U,{start:{x:20,y:(null!==g&&void 0!==g?g:0)-2},end:{x:20,y:50},shaftWidth:8,tipLength:28,tipWidth:20,color:"#eee"})),o.a.createElement(n,{synchronizationState:a}),o.a.createElement("div",{className:d.clientLogEntry},function(e){switch(e.type){case O.USER_EDIT_ADDED_TO_BUFFER:return o.a.createElement(s,e);case O.USER_EDIT_IMMEDIATELY_SENT_TO_SERVER:return o.a.createElement(i,e);case O.USER_EDIT_STORED_AS_BUFFER:return o.a.createElement(c,e);case O.RECEIVED_OWN_OPERATION:return o.a.createElement(p,e);case O.RECEIVED_OWN_OPERATION_AND_SENT_BUFFER:return o.a.createElement(u,e);case O.RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED:return o.a.createElement(m,e);case O.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION:return o.a.createElement(E,e);case O.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER:return o.a.createElement(f,e)}}(t))))}},te=Object(s.a)({operationInSocket:{position:"absolute",transform:"translate(0, -50%)",transitionProperty:"top",transitionDuration:"0.5s"}}),ne=function(e){return function(t){var n=te(),a=function(){var e=Object(r.useState)(!0),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=setTimeout((function(){a(!1)}),10);return function(){clearTimeout(e)}}),[]),n}()&&void 0!==t.initialPositionTop?{top:t.initialPositionTop}:void 0!==t.positionTop?{top:t.positionTop}:{},i=t.disableHover?{pointerEvents:"none"}:{};return o.a.createElement(e,{operation:t.operation,className:n.operationInSocket,style:Object(u.a)(Object(u.a)({},a),i),onTransitionEnd:t.onTransitionEnd})}},ae=Object(s.a)({socket:{position:"relative",margin:"0 40px",height:"100%"},line:{position:"absolute",left:"-1px",height:"100%",borderLeft:"2px dashed #eee",zIndex:"-1"},operations:{position:"relative",height:"100%",width:"20px",left:"-10px",overflowY:"hidden",overflowX:"visible"},receiveButton:{"&$receiveButton":{backgroundColor:"#222",color:"#FFDC00",position:"absolute",padding:"2px",transform:"translate(-50%, -50%)",zIndex:"20","&:hover":{backgroundColor:"#444"},"&[class*=Mui-disabled]":{backgroundColor:"#ccc",color:"#eee"}}}});!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(X||(X={}));var re=Object(s.a)({client:{width:"460px",display:"flex",flexDirection:"column",position:"relative",zIndex:"10",paddingBottom:"12px",borderBottom:"2px solid #fff"},sockets:{display:"flex",flexDirection:"row",justifyContent:"center",position:"relative",height:"150px"}}),oe=function(e){var t=function(e){var t=ne(e);return function(e){var n=e.queue,a=e.onReceiveClick,i=e.direction,c=e.tooltip,s=ae(),p=0===n.length,u=Object(r.useState)([]),E=Object(l.a)(u,2),f=E[0],d=E[1];Object(r.useEffect)((function(){d((function(e){return[].concat(Object(m.a)(e.filter((function(e){return!n.includes(e)}))),Object(m.a)(n))}))}),[n]);var O=i===X.DOWN?"100% -":"",v=o.a.createElement(w.a,{className:s.receiveButton,onClick:a,disabled:p,style:{top:"calc(".concat(O," 0%)")}},i===X.UP?o.a.createElement(C.a,null):o.a.createElement(P.a,null)),h=f.filter((function(e){return!n.includes(e)}));return o.a.createElement("div",{className:s.socket},o.a.createElement(x.a,{title:p?"":c},v),o.a.createElement("div",{className:s.line}),o.a.createElement("div",{className:s.operations},[].concat(Object(m.a)(h.map((function(e){return o.a.createElement(t,{key:e.meta.id,operation:e,positionTop:"calc(".concat(O," 0px)"),disableHover:!0,onTransitionEnd:function(){return d((function(t){return t.filter((function(t){return t!==e}))}))}})}))),Object(m.a)(n.map((function(e,a){return o.a.createElement(t,{key:e.meta.id,operation:e,positionTop:"calc(".concat(O," 100% / ").concat(n.length+1," * ").concat(a+1,")"),initialPositionTop:"calc(".concat(O," (100% + 20px))")})}))))))}}(K(e)),n=function(e){var t=K(e),n=V(t),a=ee(e);return function(e){var t=e.clientLog,r=e.initialSynchronizationState,i=Q();return o.a.createElement("div",{className:i.clientLog},t.map((function(e,n){var r=e.entry,i=e.newState;return o.a.createElement(a,{key:"log-entry-".concat(t.length-n),entry:r,newState:i})})),o.a.createElement(n,{synchronizationState:r}))}}(e),i=e.EditorComponent;return function(e){var c=e.onClientOperation,l=e.onClientReceiveClick,s=e.onServerReceiveClick,p=e.state,u=e.clientName,m=e.className,E=re(),f=y(),d=Object(r.useRef)(null),O=Object(r.useCallback)((function(){var e,t=l();void 0!==t&&(null===(e=d.current)||void 0===e||e.applyOperation(t.base))}),[l]);return o.a.createElement("div",{className:m},o.a.createElement("div",{className:E.sockets},o.a.createElement(t,{direction:X.UP,tooltip:"Receive next operation from client",queue:p.toServer,onReceiveClick:s}),o.a.createElement(t,{direction:X.DOWN,tooltip:"Receive next operation from server",queue:p.fromServer,onReceiveClick:O})),o.a.createElement("div",{className:Object(N.a)(f.site,E.client)},o.a.createElement("h2",{style:{color:A(u)}},function(e){switch(e){case a.Alice:return o.a.createElement(F.a,null);case a.Bob:return o.a.createElement(k.a,null)}}(u),u),o.a.createElement(i,{snapshot:p.snapshot,onUserChange:c,ref:d})),o.a.createElement(n,{clientLog:p.clientLog,initialSynchronizationState:p.initialSynchronizationState}))}},ie=n(68),ce=n.n(ie),le=Object(s.a)({server:{width:"940px"},operationInLog:{verticalAlign:"-4px",marginRight:"4px"},stateTable:{lineHeight:"32px","& th":{textAlign:"left",fontWeight:"normal",color:"#666",paddingRight:"8px"}}}),se=Object(s.a)({container:{position:"relative"},clients:{display:"flex",flexDirection:"row"},alice:{},bob:{}}),pe=(n(39),n(69)),ue=(n(89),n(90),n(91),function(e){return e.replace(/\n/g,"\xac").replace(/ /g,"\xb7")}),me=Object(s.a)({codeMirrorContainer:{border:"1px solid #ccc",flex:"1","& .CodeMirror":{height:"150px"}}}),Ee={lineNumbers:!0,showInvisibles:!0},fe=n(57),de=n(15),Oe=n(70),ve=n(71);function he(e,t){return function(e,t){return e.line<t.line?-1:e.line>t.line?1:e.ch<t.ch?-1:e.ch>t.ch?1:0}(e,t)<=0}var ge,be=function(){function e(){Object(Oe.a)(this,e)}return Object(ve.a)(e,null,[{key:"operationFromCodeMirrorChanges",value:function(e,t){var n=function(e){return e.indexFromPos({line:e.lastLine(),ch:0})+e.getLine(e.lastLine()).length}(t),a=(new de.TextOperation).retain(n),r=(new de.TextOperation).retain(n),o=function(e){return t.indexFromPos(e)},i=function(e){if(0===e.length)return 0;for(var t=0,n=0;n<e.length;n++)t+=e[n].length;return t+e.length-1};function c(e,t){return function(n){var a,r,o;return he(n,t.from)?e(n):he(t.to,n)?e({line:n.line+t.text.length-1-(t.to.line-t.from.line),ch:t.to.line<n.line?n.ch:t.text.length<=1?n.ch-(t.to.ch-t.from.ch)+i(t.text):n.ch-t.to.ch+(o=t.text,o[o.length-1]).length})+i(null!==(r=t.removed)&&void 0!==r?r:[])-i(t.text):t.from.line===n.line?e(t.from)+n.ch-t.from.ch:e(t.from)+i((null!==(a=t.removed)&&void 0!==a?a:[]).slice(0,n.line-t.from.line))+1+n.ch}}for(var l=e.length-1;l>=0;l--){var s,p=e[l],u=(o=c(o,p))(p.from),m=n-u-i(p.text),E=null!==(s=p.removed)&&void 0!==s?s:[];a=(new de.TextOperation).retain(u).delete(i(E)).insert(p.text.join("\n")).retain(m).compose(a),r=r.compose((new de.TextOperation).retain(u).delete(i(p.text)).insert(E.join("\n")).retain(m)),n+=i(E)-i(p.text)}return[a,r]}},{key:"operationFromCodeMirrorChange",value:function(t,n){return e.operationFromCodeMirrorChanges(t,n)}},{key:"applyOperationToCodeMirror",value:function(e,t){t.operation((function(){for(var n=e.ops,a=0,r=0,o=n.length;r<o;r++){var i=n[r];if(de.TextOperation.isRetain(i))a+=i;else if(de.TextOperation.isInsert(i))t.replaceRange(i,t.posFromIndex(a)),a+=i.length;else if(de.TextOperation.isDelete(i)){var c=t.posFromIndex(a),l=t.posFromIndex(a-i);t.replaceRange("",c,l)}}}))}}]),e}();!function(e){e.Insert="INSERT",e.Delete="DELETE"}(ge||(ge={}));var Ie=function(e,t){return{type:ge.Insert,position:e,content:t}},Re=function(e,t){return 0===t?[]:[{type:ge.Delete,position:e,length:t}]};function Te(e,t){var n,a=(new de.TextOperation).retain(t),r=Object(fe.a)(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;switch(o.type){case ge.Insert:a=a.compose((new de.TextOperation).retain(o.position).insert(o.content).retain(t-o.position)),t+=o.content.length;break;case ge.Delete:a=a.compose((new de.TextOperation).retain(o.position).delete(o.length).retain(t-o.position-o.length)),t-=o.length}}}catch(i){r.e(i)}finally{r.f()}return a}var Se,_e,Ne=(Se=function(e,t){var n=t.getDoc().getValue().length;be.applyOperationToCodeMirror(Te(e,n),t)},_e=function(e,t){var n=be.operationFromCodeMirrorChanges(e,t);return function(e){var t,n=[],a=0,r=Object(fe.a)(e.ops);try{for(r.s();!(t=r.n()).done;){var o=t.value;"string"===typeof o?(n.push(Ie(a,o)),a+=o.length):o<0?n.push.apply(n,Object(m.a)(Re(a,-o))):a+=o}}catch(i){r.e(i)}finally{r.f()}return n}(Object(l.a)(n,1)[0])},Object(r.forwardRef)((function(e,t){var n=e.snapshot,a=e.onUserChange,i=me(),c=Object(r.useState)((function(){return n})),s=Object(l.a)(c,1)[0],p=Object(r.useState)(void 0),u=Object(l.a)(p,2),m=u[0],E=u[1],f=Object(r.useRef)(!1),d=Object(r.useCallback)((function(e,t){f.current||a(_e(t,e))}),[a,f]);return Object(r.useEffect)((function(){if(void 0!==m)return m.on("changes",d),function(){m.off("changes",d)}}),[m,d]),Object(r.useImperativeHandle)(t,(function(){return{applyOperation:function(e){void 0!==m&&(f.current=!0,Se(e,m),f.current=!1)}}})),o.a.createElement(pe.UnControlled,{className:i.codeMirrorContainer,options:Ee,value:s,editorDidMount:E})}))),ye={renderOperation:function(e){return e.map((function(e,t){return o.a.createElement("p",{key:t},function(e){switch(e.type){case ge.Insert:return"Insert(pos=".concat(e.position,', content="').concat(ue(e.content).replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'")');case ge.Delete:return"Delete(pos=".concat(e.position,", length=").concat(e.length,")")}}(e))}))},renderSnapshot:function(e){return o.a.createElement("span",{style:{whiteSpace:"pre",backgroundColor:"white",fontFamily:"monospace"}},ue(e))},EditorComponent:Ne};function Ae(e,t){if(e.position<=t.position)return[e,Re(t.position+e.content.length,t.length)];if(t.position+t.length<=e.position)return[Ie(e.position-t.length,e.content),[t]];var n=e.position-t.position;return[Ie(t.position,e.content),[].concat(Object(m.a)(Re(t.position,n)),Object(m.a)(Re(t.position+e.content.length,t.length-n)))]}function we(e,t){if(0===t.length)return[[e],t];var n=Object(p.a)(t),a=n[0],r=n.slice(1),o=function(e,t){if(e.type===ge.Insert){if(t.type===ge.Insert)return e.position<=t.position?[[e],[Ie(t.position+e.content.length,t.content)]]:[[Ie(e.position+t.content.length,e.content)],[t]];var n=Ae(e,t),a=Object(l.a)(n,2);return[[a[0]],a[1]]}if(t.type===ge.Insert){var r=Ae(t,e),o=Object(l.a)(r,2),i=o[0];return[o[1],[i]]}if(e.position+e.length<t.position)return[[e],Re(t.position-e.length,t.length)];if(t.position+t.length<e.position)return[Re(e.position-t.length,e.length),[t]];var c=Math.min(e.position,t.position),s=Math.max(e.position+e.length,t.position+t.length)-c;return[Re(c,s-t.length),Re(c,s-e.length)]}(e,a),i=Object(l.a)(o,2),c=i[0],s=i[1],u=xe(c,r),E=Object(l.a)(u,2),f=E[0],d=E[1];return[f,[].concat(Object(m.a)(s),Object(m.a)(d))]}function xe(e,t){var n=t;return[e.flatMap((function(e){var t=we(e,n),a=Object(l.a)(t,2),r=a[0],o=a[1];return n=o,r})),n]}var je={transform:xe,compose:function(e,t){return[].concat(Object(m.a)(e),Object(m.a)(t))},apply:function(e,t){return Te(e,t.length).apply(t)}},Ce=Object(s.a)({wrapper:{width:"940px",margin:"20px auto"},header:{margin:"0 0 40px",textAlign:"center","& abbr":{textDecorationStyle:"dotted",textDecorationColor:"#aaa",textDecorationThickness:"2px"}}}),De=function(e,t){var n=function(e){var t=K(e);return function(n){var a=n.state,r=y(),i=le();return o.a.createElement("div",{className:Object(N.a)(r.site,i.server)},o.a.createElement("h2",null,o.a.createElement(ce.a,null),"Central Server"),o.a.createElement("table",{className:i.stateTable},o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Document:"),o.a.createElement("td",null,e.renderSnapshot(a.snapshot))),o.a.createElement("tr",null,o.a.createElement("th",null,"Operations:"),o.a.createElement("td",null,0===a.operations.length?o.a.createElement(o.a.Fragment,null,"none yet"):o.a.createElement(o.a.Fragment,null),a.operations.map((function(e){return o.a.createElement(t,{key:e.meta.id,operation:e,className:i.operationInLog})})))))))}}(t),i=oe(t),c={get:function(e){return e.alice},set:function(e,t){return Object(u.a)(Object(u.a)({},e),{},{alice:t})}},s={get:function(e){return e.bob},set:function(e,t){return Object(u.a)(Object(u.a)({},e),{},{bob:t})}};return function(t){var p=t.initialSnapshot,u=se(),m=Object(r.useState)((function(){return function(e){var t={toServer:[],fromServer:[],initialSynchronizationState:{status:d.SYNCHRONIZED,serverRevision:0},clientLog:[],snapshot:e};return{alice:t,bob:t,server:{operations:[],snapshot:e}}}(p)})),E=Object(l.a)(m,2),f=E[0],O=E[1],v=function(t,n){return{state:t.get(f),onClientOperation:function(a){O((function(r){return function(e,t,n,a,r){var o=I(e,n.get(t),r,a);return n.set(t,o)}(e,r,t,n,a)}))},onServerReceiveClick:function(){O((function(n){return T(e,n,t)}))},onClientReceiveClick:function(){var n=void 0;return O((function(a){var r=function(e,t,n){var a=S(e,n.get(t)),r=a.newClientState,o=a.transformedReceivedOperationToApply;return{newState:n.set(t,r),transformedReceivedOperationToApply:o}}(e,a,t),o=r.newState,i=r.transformedReceivedOperationToApply;return n=i,o})),n}}};return o.a.createElement("div",{className:u.container},o.a.createElement(n,{state:f.server}),o.a.createElement("div",{className:u.clients},o.a.createElement(i,Object.assign({clientName:a.Alice,className:u.alice},v(c,a.Alice))),o.a.createElement(i,Object.assign({clientName:a.Bob,className:u.bob},v(s,a.Bob)))))}}(je,ye);var Pe=function(){var e=Ce();return o.a.createElement(Y,null,o.a.createElement("div",{className:e.wrapper},o.a.createElement("h1",{className:e.header},"Visualization of ",o.a.createElement("abbr",{title:"Operational Transformation"},"OT")," with a central server"),o.a.createElement(De,{initialSnapshot:"Lorem ipsum"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(101);c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Pe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},77:function(e,t,n){e.exports=n(102)}},[[77,1,2]]]);
//# sourceMappingURL=main.c694aa84.chunk.js.map