(this["webpackJsonpot-demo"]=this["webpackJsonpot-demo"]||[]).push([[0],{102:function(e,t,n){},103:function(e,t,n){"use strict";n.r(t);var o,r=n(0),i=n.n(r),a=n(13),c=n.n(a),s=n(3),l=n(6),p=n(10),O=n(39),u=n(8);function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function f(){return"".concat(d()).concat(d(),"-").concat(d(),"-").concat(d(),"-").concat(d(),"-").concat(d()).concat(d()).concat(d())}!function(e){e.Alice="Alice",e.Bob="Bob"}(o||(o={}));var j,b,h=function(e,t){return{base:e,transformedAgainst:[],meta:{author:t,id:f()}}},v=function(e,t,n){var o=e(t.base,n.base),r=Object(l.a)(o,2),i=r[0],a=r[1];return[{base:i,transformedAgainst:[].concat(Object(u.a)(t.transformedAgainst),[n.meta.id]),meta:t.meta},{base:a,transformedAgainst:[].concat(Object(u.a)(n.transformedAgainst),[t.meta.id]),meta:n.meta,revision:n.revision+1}]},m=function(e,t,n){if(0!==t.transformedAgainst.length)throw new Error("you shouldn't compose a transformed operation because composition and transformation are not compatible");return{meta:{author:t.meta.author,id:f()},transformedAgainst:[],revision:t.revision,base:e(t.base,n)}};!function(e){e.SYNCHRONIZED="SYNCHRONIZED",e.AWAITING_OPERATION="AWAITING_OPERATION",e.AWAITING_OPERATION_WITH_BUFFER="AWAITING_OPERATION_WITH_BUFFER"}(j||(j={})),function(e){e.USER_EDIT_IMMEDIATELY_SENT_TO_SERVER="USER_EDIT_IMMEDIATELY_SENT_TO_SERVER",e.USER_EDIT_STORED_AS_BUFFER="USER_EDIT_STORED_AS_BUFFER",e.USER_EDIT_ADDED_TO_BUFFER="USER_EDIT_ADDED_TO_BUFFER",e.RECEIVED_OWN_OPERATION="RECEIVED_OWN_OPERATION",e.RECEIVED_OWN_OPERATION_AND_SENT_BUFFER="RECEIVED_OWN_OPERATION_AND_SENT_BUFFER",e.RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED="RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED",e.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION="RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION",e.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER="RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER"}(b||(b={}));function E(e){var t=e.clientLog,n=e.initialSynchronizationState;return t.length>0?t[0].newState:n}function x(e,t,n,o){var r=t.initialSynchronizationState,i=t.clientLog,a=t.toServer,c=t.fromServer,l=t.snapshot,p=function(e,t,n,o){switch(t.status){case j.SYNCHRONIZED:var r=t.serverRevision,i=Object(s.a)(Object(s.a)({},h(n,o)),{},{revision:r});return{newSynchronizationState:{status:j.AWAITING_OPERATION,awaitedOperation:i},operationsToSendToServer:[i],newClientLogEntry:{type:b.USER_EDIT_IMMEDIATELY_SENT_TO_SERVER,operation:i}};case j.AWAITING_OPERATION:var a=t.awaitedOperation.revision+1,c=Object(s.a)(Object(s.a)({},h(n,o)),{},{revision:a});return{newSynchronizationState:{status:j.AWAITING_OPERATION_WITH_BUFFER,awaitedOperation:t.awaitedOperation,buffer:c},operationsToSendToServer:[],newClientLogEntry:{type:b.USER_EDIT_STORED_AS_BUFFER,operation:c}};case j.AWAITING_OPERATION_WITH_BUFFER:return{newSynchronizationState:{status:j.AWAITING_OPERATION_WITH_BUFFER,awaitedOperation:t.awaitedOperation,buffer:m(e,t.buffer,n)},operationsToSendToServer:[],newClientLogEntry:{type:b.USER_EDIT_ADDED_TO_BUFFER,base:n}}}}(e.compose,E(t),n,o),O=p.newSynchronizationState,d=p.operationsToSendToServer;return{clientLog:[{entry:p.newClientLogEntry,newState:O}].concat(Object(u.a)(i)),toServer:[].concat(Object(u.a)(a),Object(u.a)(d)),fromServer:c,snapshot:e.apply(n,l),initialSynchronizationState:r}}function g(e,t){return Object(s.a)(Object(s.a)({},e),{},{fromServer:[].concat(Object(u.a)(e.fromServer),[t])})}function I(e,t,n){var o=n.get(t),r=Object(O.a)(o.toServer),i=r[0],a=r.slice(1),c=Object(s.a)(Object(s.a)({},o),{},{toServer:a}),l=n.set(t,c),p=function(e,t,n){var o=t.operations.slice(n.revision).reduce((function(t,n){return v(e.transform,n,t)[1]}),n);return{operationToBroadcast:o,newServerState:{operations:[].concat(Object(u.a)(t.operations),[o]),snapshot:e.apply(o.base,t.snapshot)}}}(e,l.server,i),d=p.newServerState,f=p.operationToBroadcast;return{server:d,alice:g(l.alice,f),bob:g(l.bob,f)}}function R(e,t){var n=t.initialSynchronizationState,o=t.clientLog,r=t.fromServer,i=t.toServer,a=t.snapshot,c=Object(O.a)(r),s=c[0],p=c.slice(1),d=function(e,t,n){switch(t.status){case j.SYNCHRONIZED:return{newSynchronizationState:{status:j.SYNCHRONIZED,serverRevision:t.serverRevision+1},operationToSendToServer:void 0,transformedReceivedOperationToApply:n,newClientLogEntry:{type:b.RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED,receivedOperation:n}};case j.AWAITING_OPERATION:var o=t.awaitedOperation;if(n.meta.id===o.meta.id)return{newSynchronizationState:{status:j.SYNCHRONIZED,serverRevision:o.revision+1},operationToSendToServer:void 0,transformedReceivedOperationToApply:void 0,newClientLogEntry:{type:b.RECEIVED_OWN_OPERATION,acknowledgedOperation:n}};var r=v(e,n,o),i=Object(l.a)(r,2),a=i[0],c=i[1];return{newSynchronizationState:{status:j.AWAITING_OPERATION,awaitedOperation:c},operationToSendToServer:void 0,transformedReceivedOperationToApply:a,newClientLogEntry:{type:b.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION,receivedOperation:n,transformedReceivedOperation:a,awaitedOperation:o,transformedAwaitedOperation:c}};case j.AWAITING_OPERATION_WITH_BUFFER:var s=t.awaitedOperation,p=t.buffer;if(n.meta.id===s.meta.id)return{newSynchronizationState:{status:j.AWAITING_OPERATION,awaitedOperation:t.buffer},operationToSendToServer:t.buffer,transformedReceivedOperationToApply:void 0,newClientLogEntry:{type:b.RECEIVED_OWN_OPERATION_AND_SENT_BUFFER,acknowledgedOperation:n,sentBuffer:t.buffer}};var O=v(e,n,s),u=Object(l.a)(O,2),d=u[0],f=u[1],h=v(e,d,p),m=Object(l.a)(h,2),E=m[0],x=m[1];return{newSynchronizationState:{status:j.AWAITING_OPERATION_WITH_BUFFER,awaitedOperation:f,buffer:x},operationToSendToServer:void 0,transformedReceivedOperationToApply:E,newClientLogEntry:{type:b.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER,receivedOperation:n,onceTransformedReceivedOperation:d,twiceTransformedReceivedOperation:E,awaitedOperation:s,transformedAwaitedOperation:f,bufferOperation:p,transformedBufferOperation:x}}}}(e.transform,E(t),s),f=d.newSynchronizationState,h=d.operationToSendToServer,m=d.transformedReceivedOperationToApply,x=d.newClientLogEntry;return{newClientState:{snapshot:void 0===m?a:e.apply(m.base,a),toServer:void 0===h?i:[].concat(Object(u.a)(i),[h]),fromServer:p,clientLog:[{entry:x,newState:f}].concat(Object(u.a)(o)),initialSynchronizationState:n},transformedReceivedOperationToApply:m}}var T,S=n(9),_=Object(p.a)({site:{background:"#eee",padding:"20px",margin:"0 15px","& h2":{margin:"0 0 16px","& svg":{margin:"0 12px 0 4px",verticalAlign:"bottom"}}}}),N=function(e){switch(e){case o.Alice:return"#0074D9";case o.Bob:return"#e2451e"}},A=n(123),y=n(122),w=n(65),C=n.n(w),D=n(66),P=n.n(D),W=n(67),F=n.n(W),L=n(68),U=n.n(L),B=n(1),H=function(e){var t=e.start,n=e.end,o=e.shaftWidth,r=e.tipLength,i=e.tipWidth,a=e.color,c=n.x-t.x,s=n.y-t.y,l=Math.sqrt(c*c+s*s),p=(i-o)/2,O=l-r;return Object(B.jsx)("path",{fill:a,transform:"matrix(".concat(c/l,", ").concat(s/l,", ").concat(-s/l,", ").concat(c/l,", ").concat(t.x,", ").concat(t.y,")"),d:"m ".concat(l,",0 -").concat(r,",-").concat(i/2," 0,").concat(p," -").concat(O,",0 0,").concat(o," ").concat(O,",0 0,").concat(p," z")})},k={shaftWidth:10,tipLength:24,tipWidth:20},z=function(e,t,n){return{x:(1-e)*t.x+e*n.x,y:(1-e)*t.y+e*n.y}},V=Object(p.a)({synchronizationState:{lineHeight:"24px",background:"#eee",padding:"12px 20px"},synchronizationStateOperation:{margin:"0 2px",verticalAlign:"-4px"},stateLabel:{color:"#666"}}),M=function(e){return function(t){var n=t.synchronizationState,o=V(),r=Object(B.jsx)("span",{className:o.stateLabel,children:"State:"});switch(n.status){case j.SYNCHRONIZED:return Object(B.jsxs)("p",{className:o.synchronizationState,children:[r," Synchronized at server revision ",n.serverRevision]});case j.AWAITING_OPERATION:return Object(B.jsxs)("p",{className:o.synchronizationState,children:[r," Awaiting operation"," ",Object(B.jsx)(e,{operation:n.awaitedOperation,className:o.synchronizationStateOperation})]});case j.AWAITING_OPERATION_WITH_BUFFER:return Object(B.jsxs)("p",{className:o.synchronizationState,children:[r," Awaiting operation"," ",Object(B.jsx)(e,{operation:n.awaitedOperation,className:o.synchronizationStateOperation})," ","with buffer"," ",Object(B.jsx)(e,{operation:n.buffer,className:o.synchronizationStateOperation})]})}}},G=n(73),Y=Object(r.createContext)([void 0,function(){throw new Error("you need to wrap this with <OperationHoverProvider />")}]),Z=function(e){var t=Object(r.useState)(void 0);return Object(B.jsx)(Y.Provider,{value:t,children:e.children})},q=Object(p.a)({operation:{display:"inline-block",width:"20px",height:"20px",borderRadius:"10px"},tooltip:{"&$tooltip":{fontSize:"13px"}}}),$=function(e,t){return e.meta.id===t.meta.id},J=function(e){switch(e){case 1:return"transformation";case 2:return"two transformations";case 3:return"three transformations";case 4:return"four transformations";case 5:return"five transformations";case 6:return"six transformations";case 7:return"seven transformations";case 8:return"eight transformations";case 9:return"nine transformations";default:return"multiple transformations"}},X=function(e,t){if(function(e,t){for(var n=Math.min(e.length,t.length),o=0;o<n;o++)if(e[o]!==t[o])return!1;return!0}(e.transformedAgainst,t.transformedAgainst)){var n=e.transformedAgainst.length-t.transformedAgainst.length;return n<0?"before ".concat(J(-n)):n>0?"after ".concat(J(n)):"identical"}return"differently transformed"};!function(e){e.Closed="CLOSED",e.Closing="CLOSING",e.Open="OPEN"}(T||(T={}));var K,Q=function(e){return function(t){var n=q(),o=(t.className,t.style),i=t.operation,a=t.tooltipPlacement,c=Object(G.a)(t,["className","style","operation","tooltipPlacement"]),p=Object(r.useState)(""),O=Object(l.a)(p,2),u=O[0],d=O[1],f=Object(r.useState)(T.Closed),j=Object(l.a)(f,2),b=j[0],h=j[1],v=Object(r.useContext)(Y),m=Object(l.a)(v,2),E=m[0],x=m[1];Object(r.useEffect)((function(){b===T.Closed&&void 0!==E&&$(E,i)?d(X(i,E)):b===T.Closing&&void 0===E&&h(T.Closed)}),[b,E,i]);var g=Object(r.useCallback)((function(){h(T.Open),d(function(e,t){return Object(B.jsxs)(B.Fragment,{children:[void 0!==t.revision?Object(B.jsxs)("p",{style:{textAlign:"center",fontWeight:"bold"},children:["Revision: ",t.revision]}):Object(B.jsx)(B.Fragment,{}),Object(B.jsx)("div",{children:e(t.base)})]})}(e.renderOperation,i)),x(i)}),[i,x]),I=Object(r.useCallback)((function(){h(E?T.Closing:T.Closed),x(void 0)}),[E,x]),R=void 0!==E&&$(i,E);return Object(B.jsx)(y.a,{arrow:!0,classes:{tooltip:n.tooltip},title:u,open:b===T.Open||R,placement:null!==a&&void 0!==a?a:"bottom",onOpen:g,onClose:I,children:Object(B.jsx)("span",Object(s.a)({className:Object(S.a)(n.operation,t.className),style:Object(s.a)({background:N(i.meta.author)},o)},c),i.meta.id)},i.meta.id)}},ee=Object(p.a)({clientLog:{margin:"0 15px 20px",lineHeight:"24px"},clientLogItem:{transition:"margin 0.5s ease, height 0.5s ease",overflow:"hidden",position:"relative","& > div":{position:"absolute",left:"0",right:"0",bottom:"0"}},clientLogEntry:{padding:"12px 20px 12px 40px"},inlineOperation:{margin:"0 2px",verticalAlign:"-4px"}}),te=function(e){var t=Q(e),n=M(t),o=function(e){return function(t){var n=t.width,o=t.height,r=t.arrows;return Object(B.jsxs)("div",{style:{position:"relative",width:"".concat(n,"px"),height:"".concat(o,"px"),margin:"0 auto"},children:[Object(B.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:o,style:{position:"absolute",opacity:"0.2"},children:r.map((function(e,t){var n=e.operation,o=e.start,r=e.end;return Object(B.jsx)(H,Object(s.a)({start:z(.1,o,r),end:z(.95,o,r),color:N(n.meta.author)},k),t)}))}),r.map((function(t,n){var o=t.operation,r=t.start,i=t.end,a=t.tooltipPlacement,c=z(.45,r,i),s={position:"absolute",left:"".concat(c.x-10,"px"),top:"".concat(c.y-10,"px")};return Object(B.jsx)(e,{operation:o,tooltipPlacement:a,style:s},n)}))]})}}(t),i=function(e){var n=ee();return Object(B.jsxs)("p",{children:["User edit"," ",Object(B.jsx)(t,{className:n.inlineOperation,operation:e.operation})," ","was sent to the server."]})},a=function(e){var n=ee();return Object(B.jsxs)("p",{children:["User edit"," ",Object(B.jsx)(t,{className:n.inlineOperation,operation:e.operation})," ","was stored in buffer."]})},c=function(e){return Object(B.jsx)("p",{children:"Added user edit to buffer."})},p=function(e){var n=ee();return Object(B.jsxs)("p",{children:["Received acknowledgment of own operation"," ",Object(B.jsx)(t,{className:n.inlineOperation,operation:e.acknowledgedOperation}),"."]})},O=function(e){var n=ee();return Object(B.jsxs)("p",{children:["Received acknowledgment of own operation"," ",Object(B.jsx)(t,{className:n.inlineOperation,operation:e.acknowledgedOperation})," ","and sent buffer"," ",Object(B.jsx)(t,{className:n.inlineOperation,operation:e.sentBuffer}),"."]})},u=function(e){var n=ee();return Object(B.jsxs)("p",{children:["Received operation"," ",Object(B.jsx)(t,{className:n.inlineOperation,operation:e.receivedOperation})," ","from the server and immediately applied it to the document."]})},d=function(e){var n=e.receivedOperation,r=e.transformedReceivedOperation,i=e.awaitedOperation,a=e.transformedAwaitedOperation,c=ee(),s={x:20,y:15},l={x:125,y:20},p={x:15,y:120},O={x:120,y:125},u=[{operation:i,start:s,end:l,tooltipPlacement:"top"},{operation:a,start:p,end:O,tooltipPlacement:"bottom"},{operation:n,start:s,end:p,tooltipPlacement:"left"},{operation:r,start:l,end:O,tooltipPlacement:"right"}];return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(o,{width:140,height:140,arrows:u}),Object(B.jsxs)("p",{style:{marginTop:"4px"},children:["Transformed received operation"," ",Object(B.jsx)(t,{className:c.inlineOperation,operation:n})," ","against the awaited transformation"," ",Object(B.jsx)(t,{className:c.inlineOperation,operation:i})," ","resulting in"," ",Object(B.jsx)(t,{className:c.inlineOperation,operation:r})," ","(applied to the editor) and a new awaited operation"," ",Object(B.jsx)(t,{className:c.inlineOperation,operation:a}),"."]})]})},f=function(e){var n=e.receivedOperation,r=e.onceTransformedReceivedOperation,i=e.twiceTransformedReceivedOperation,a=e.awaitedOperation,c=e.transformedAwaitedOperation,s=e.bufferOperation,l=e.transformedBufferOperation,p=ee(),O={x:20,y:15},u={x:125,y:20},d={x:230,y:25},f={x:15,y:120},j={x:120,y:125},b={x:225,y:130},h=[{operation:a,start:O,end:u,tooltipPlacement:"top"},{operation:c,start:f,end:j,tooltipPlacement:"bottom"},{operation:s,start:u,end:d,tooltipPlacement:"top"},{operation:l,start:j,end:b,tooltipPlacement:"bottom"},{operation:n,start:O,end:f,tooltipPlacement:"left"},{operation:r,start:u,end:j,tooltipPlacement:"bottom"},{operation:i,start:d,end:b,tooltipPlacement:"right"}];return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(o,{width:245,height:145,arrows:h}),Object(B.jsxs)("p",{style:{marginTop:"4px"},children:["Transformed received operation"," ",Object(B.jsx)(t,{className:p.inlineOperation,operation:n})," ","first against the awaited transformation"," ",Object(B.jsx)(t,{className:p.inlineOperation,operation:a})," ","and then against the buffer"," ",Object(B.jsx)(t,{className:p.inlineOperation,operation:s})," ","resulting in"," ",Object(B.jsx)(t,{className:p.inlineOperation,operation:i})," ","(applied to the editor), a new awaited operation"," ",Object(B.jsx)(t,{className:p.inlineOperation,operation:c})," ","and a new buffer"," ",Object(B.jsx)(t,{className:p.inlineOperation,operation:l}),"."]})]})},j=function(e){switch(e.type){case b.USER_EDIT_ADDED_TO_BUFFER:return Object(B.jsx)(c,Object(s.a)({},e));case b.USER_EDIT_IMMEDIATELY_SENT_TO_SERVER:return Object(B.jsx)(i,Object(s.a)({},e));case b.USER_EDIT_STORED_AS_BUFFER:return Object(B.jsx)(a,Object(s.a)({},e));case b.RECEIVED_OWN_OPERATION:return Object(B.jsx)(p,Object(s.a)({},e));case b.RECEIVED_OWN_OPERATION_AND_SENT_BUFFER:return Object(B.jsx)(O,Object(s.a)({},e));case b.RECEIVED_SERVER_OPERATION_WHILE_SYNCHRONIZED:return Object(B.jsx)(u,Object(s.a)({},e));case b.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION:return Object(B.jsx)(d,Object(s.a)({},e));case b.RECEIVED_SERVER_OPERATION_WHILE_AWAITING_OPERATION_WITH_BUFFER:return Object(B.jsx)(f,Object(s.a)({},e))}};return function(e){var t=e.entry,o=e.newState,i=ee(),a=Object(r.useState)(void 0),c=Object(l.a)(a,2),s=c[0],p=c[1],O=Object(r.useCallback)((function(e){var t=e.getBoundingClientRect();p(t.height)}),[]);return Object(B.jsx)("div",{className:i.clientLogItem,style:void 0===s?{height:"1px",margin:"-100px 0 100px"}:{height:"".concat(s,"px"),margin:"0"},children:Object(B.jsxs)("div",{ref:O,children:[Object(B.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:null!==s&&void 0!==s?s:"0",style:{position:"absolute",zIndex:-1},children:Object(B.jsx)(H,{start:{x:20,y:(null!==s&&void 0!==s?s:0)-2},end:{x:20,y:50},shaftWidth:8,tipLength:28,tipWidth:20,color:"#eee"})}),Object(B.jsx)(n,{synchronizationState:o}),Object(B.jsx)("div",{className:i.clientLogEntry,children:j(t)})]})})}},ne=Object(p.a)({operationInSocket:{position:"absolute",transform:"translate(0, -50%)",transitionProperty:"top",transitionDuration:"0.5s"}}),oe=function(e){return function(t){var n=ne(),o=function(){var e=Object(r.useState)(!0),t=Object(l.a)(e,2),n=t[0],o=t[1];return Object(r.useEffect)((function(){var e=setTimeout((function(){o(!1)}),10);return function(){clearTimeout(e)}}),[]),n}()&&void 0!==t.initialPositionTop?{top:t.initialPositionTop}:void 0!==t.positionTop?{top:t.positionTop}:{},i=t.disableHover?{pointerEvents:"none"}:{};return Object(B.jsx)(e,{operation:t.operation,className:n.operationInSocket,style:Object(s.a)(Object(s.a)({},o),i),onTransitionEnd:t.onTransitionEnd})}},re=Object(p.a)({socket:{position:"relative",margin:"0 40px",height:"100%"},line:{position:"absolute",left:"-1px",height:"100%",borderLeft:"2px dashed #eee",zIndex:"-1"},operations:{position:"relative",height:"100%",width:"20px",left:"-10px",overflowY:"hidden",overflowX:"visible"},receiveButton:{"&$receiveButton":{backgroundColor:"#222",color:"#FFDC00",position:"absolute",padding:"2px",transform:"translate(-50%, -50%)",zIndex:"20","&:hover":{backgroundColor:"#444"},"&[class*=Mui-disabled]":{backgroundColor:"#ccc",color:"#eee"}}}});!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(K||(K={}));var ie=Object(p.a)({client:{width:"460px",display:"flex",flexDirection:"column",position:"relative",zIndex:"10",paddingBottom:"12px",borderBottom:"2px solid #fff"},sockets:{display:"flex",flexDirection:"row",justifyContent:"center",position:"relative",height:"150px"}}),ae=function(e){switch(e){case o.Alice:return Object(B.jsx)(F.a,{});case o.Bob:return Object(B.jsx)(U.a,{})}},ce=function(e){var t=function(e){var t=oe(e);return function(e){var n=e.queue,o=e.onReceiveClick,i=e.direction,a=e.tooltip,c=re(),s=0===n.length,p=Object(r.useState)([]),O=Object(l.a)(p,2),d=O[0],f=O[1];Object(r.useEffect)((function(){f((function(e){return[].concat(Object(u.a)(e.filter((function(e){return!n.includes(e)}))),Object(u.a)(n))}))}),[n]);var j=i===K.DOWN?"100% -":"",b=Object(B.jsx)(A.a,{className:c.receiveButton,onClick:o,disabled:s,style:{top:"calc(".concat(j," 0%)")},children:i===K.UP?Object(B.jsx)(C.a,{}):Object(B.jsx)(P.a,{})}),h=d.filter((function(e){return!n.includes(e)}));return Object(B.jsxs)("div",{className:c.socket,children:[Object(B.jsx)(y.a,{title:s?"":a,children:b}),Object(B.jsx)("div",{className:c.line}),Object(B.jsx)("div",{className:c.operations,children:[].concat(Object(u.a)(h.map((function(e){return Object(B.jsx)(t,{operation:e,positionTop:"calc(".concat(j," 0px)"),disableHover:!0,onTransitionEnd:function(){return f((function(t){return t.filter((function(t){return t!==e}))}))}},e.meta.id)}))),Object(u.a)(n.map((function(e,o){return Object(B.jsx)(t,{operation:e,positionTop:"calc(".concat(j," 100% / ").concat(n.length+1," * ").concat(o+1,")"),initialPositionTop:"calc(".concat(j," (100% + 20px))")},e.meta.id)}))))})]})}}(Q(e)),n=function(e){var t=Q(e),n=M(t),o=te(e);return function(e){var t=e.clientLog,r=e.initialSynchronizationState,i=ee();return Object(B.jsxs)("div",{className:i.clientLog,children:[t.map((function(e,n){var r=e.entry,i=e.newState;return Object(B.jsx)(o,{entry:r,newState:i},"log-entry-".concat(t.length-n))})),Object(B.jsx)(n,{synchronizationState:r})]})}}(e),o=e.EditorComponent;return function(e){var i=e.onClientOperation,a=e.onClientReceiveClick,c=e.onServerReceiveClick,s=e.state,l=e.clientName,p=e.className,O=ie(),u=_(),d=Object(r.useRef)(null),f=Object(r.useCallback)((function(){var e,t=a();void 0!==t&&(null===(e=d.current)||void 0===e||e.applyOperation(t.base))}),[a]);return Object(B.jsxs)("div",{className:p,children:[Object(B.jsxs)("div",{className:O.sockets,children:[Object(B.jsx)(t,{direction:K.UP,tooltip:"Receive next operation from client",queue:s.toServer,onReceiveClick:c}),Object(B.jsx)(t,{direction:K.DOWN,tooltip:"Receive next operation from server",queue:s.fromServer,onReceiveClick:f})]}),Object(B.jsxs)("div",{className:Object(S.a)(u.site,O.client),children:[Object(B.jsxs)("h2",{style:{color:N(l)},children:[ae(l),l]}),Object(B.jsx)(o,{snapshot:s.snapshot,onUserChange:i,ref:d})]}),Object(B.jsx)(n,{clientLog:s.clientLog,initialSynchronizationState:s.initialSynchronizationState})]})}},se=n(69),le=n.n(se),pe=Object(p.a)({server:{width:"940px"},operationInLog:{verticalAlign:"-4px",marginRight:"4px"},stateTable:{lineHeight:"32px","& th":{textAlign:"left",fontWeight:"normal",color:"#666",paddingRight:"8px"}}}),Oe=Object(p.a)({container:{position:"relative"},clients:{display:"flex",flexDirection:"row"},alice:{},bob:{}}),ue=n(70),de=(n(90),n(91),n(92),function(e){return e.replace(/\n/g,"\xac").replace(/ /g,"\xb7")}),fe=Object(p.a)({codeMirrorContainer:{border:"1px solid #ccc",flex:"1","& .CodeMirror":{height:"150px"}}}),je={lineNumbers:!0,showInvisibles:!0},be=n(59),he=n(16),ve=n(71),me=n(72);function Ee(e,t){return function(e,t){return e.line<t.line?-1:e.line>t.line?1:e.ch<t.ch?-1:e.ch>t.ch?1:0}(e,t)<=0}var xe,ge=function(){function e(){Object(ve.a)(this,e)}return Object(me.a)(e,null,[{key:"operationFromCodeMirrorChanges",value:function(e,t){var n=function(e){return e.indexFromPos({line:e.lastLine(),ch:0})+e.getLine(e.lastLine()).length}(t),o=(new he.TextOperation).retain(n),r=(new he.TextOperation).retain(n),i=function(e){return t.indexFromPos(e)},a=function(e){if(0===e.length)return 0;for(var t=0,n=0;n<e.length;n++)t+=e[n].length;return t+e.length-1};function c(e,t){return function(n){var o,r,i;return Ee(n,t.from)?e(n):Ee(t.to,n)?e({line:n.line+t.text.length-1-(t.to.line-t.from.line),ch:t.to.line<n.line?n.ch:t.text.length<=1?n.ch-(t.to.ch-t.from.ch)+a(t.text):n.ch-t.to.ch+(i=t.text,i[i.length-1]).length})+a(null!==(r=t.removed)&&void 0!==r?r:[])-a(t.text):t.from.line===n.line?e(t.from)+n.ch-t.from.ch:e(t.from)+a((null!==(o=t.removed)&&void 0!==o?o:[]).slice(0,n.line-t.from.line))+1+n.ch}}for(var s=e.length-1;s>=0;s--){var l,p=e[s],O=(i=c(i,p))(p.from),u=n-O-a(p.text),d=null!==(l=p.removed)&&void 0!==l?l:[];o=(new he.TextOperation).retain(O).delete(a(d)).insert(p.text.join("\n")).retain(u).compose(o),r=r.compose((new he.TextOperation).retain(O).delete(a(p.text)).insert(d.join("\n")).retain(u)),n+=a(d)-a(p.text)}return[o,r]}},{key:"operationFromCodeMirrorChange",value:function(t,n){return e.operationFromCodeMirrorChanges(t,n)}},{key:"applyOperationToCodeMirror",value:function(e,t){t.operation((function(){for(var n=e.ops,o=0,r=0,i=n.length;r<i;r++){var a=n[r];if(he.TextOperation.isRetain(a))o+=a;else if(he.TextOperation.isInsert(a))t.replaceRange(a,t.posFromIndex(o)),o+=a.length;else if(he.TextOperation.isDelete(a)){var c=t.posFromIndex(o),s=t.posFromIndex(o-a);t.replaceRange("",c,s)}}}))}}]),e}();!function(e){e.Insert="INSERT",e.Delete="DELETE"}(xe||(xe={}));var Ie=function(e,t){return{type:xe.Insert,position:e,content:t}},Re=function(e,t){return 0===t?[]:[{type:xe.Delete,position:e,length:t}]};function Te(e,t){var n,o=(new he.TextOperation).retain(t),r=Object(be.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;switch(i.type){case xe.Insert:o=o.compose((new he.TextOperation).retain(i.position).insert(i.content).retain(t-i.position)),t+=i.content.length;break;case xe.Delete:o=o.compose((new he.TextOperation).retain(i.position).delete(i.length).retain(t-i.position-i.length)),t-=i.length}}}catch(a){r.e(a)}finally{r.f()}return o}var Se,_e,Ne=(Se=function(e,t){var n=t.getDoc().getValue().length;ge.applyOperationToCodeMirror(Te(e,n),t)},_e=function(e,t){var n=ge.operationFromCodeMirrorChanges(e,t);return function(e){var t,n=[],o=0,r=Object(be.a)(e.ops);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"===typeof i?(n.push(Ie(o,i)),o+=i.length):i<0?n.push.apply(n,Object(u.a)(Re(o,-i))):o+=i}}catch(a){r.e(a)}finally{r.f()}return n}(Object(l.a)(n,1)[0])},Object(r.forwardRef)((function(e,t){var n=e.snapshot,o=e.onUserChange,i=fe(),a=Object(r.useState)((function(){return n})),c=Object(l.a)(a,1)[0],s=Object(r.useState)(void 0),p=Object(l.a)(s,2),O=p[0],u=p[1],d=Object(r.useRef)(!1),f=Object(r.useCallback)((function(e,t){d.current||o(_e(t,e))}),[o,d]);return Object(r.useEffect)((function(){if(void 0!==O)return O.on("changes",f),function(){O.off("changes",f)}}),[O,f]),Object(r.useImperativeHandle)(t,(function(){return{applyOperation:function(e){void 0!==O&&(d.current=!0,Se(e,O),d.current=!1)}}})),Object(B.jsx)(ue.UnControlled,{className:i.codeMirrorContainer,options:je,value:c,editorDidMount:u})}))),Ae=function(e){switch(e.type){case xe.Insert:return"Insert(pos=".concat(e.position,', content="').concat(de(e.content).replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'")');case xe.Delete:return"Delete(pos=".concat(e.position,", length=").concat(e.length,")")}},ye={renderOperation:function(e){return e.map((function(e,t){return Object(B.jsx)("p",{children:Ae(e)},t)}))},renderSnapshot:function(e){return Object(B.jsx)("span",{style:{whiteSpace:"pre",backgroundColor:"white",fontFamily:"monospace"},children:de(e)})},EditorComponent:Ne};function we(e,t){if(e.position<=t.position)return[e,Re(t.position+e.content.length,t.length)];if(t.position+t.length<=e.position)return[Ie(e.position-t.length,e.content),[t]];var n=e.position-t.position;return[Ie(t.position,e.content),[].concat(Object(u.a)(Re(t.position,n)),Object(u.a)(Re(t.position+e.content.length,t.length-n)))]}function Ce(e,t){if(0===t.length)return[[e],t];var n=Object(O.a)(t),o=n[0],r=n.slice(1),i=function(e,t){if(e.type===xe.Insert){if(t.type===xe.Insert)return e.position<=t.position?[[e],[Ie(t.position+e.content.length,t.content)]]:[[Ie(e.position+t.content.length,e.content)],[t]];var n=we(e,t),o=Object(l.a)(n,2);return[[o[0]],o[1]]}if(t.type===xe.Insert){var r=we(t,e),i=Object(l.a)(r,2),a=i[0];return[i[1],[a]]}if(e.position+e.length<t.position)return[[e],Re(t.position-e.length,t.length)];if(t.position+t.length<e.position)return[Re(e.position-t.length,e.length),[t]];var c=Math.min(e.position,t.position),s=Math.max(e.position+e.length,t.position+t.length)-c;return[Re(c,s-t.length),Re(c,s-e.length)]}(e,o),a=Object(l.a)(i,2),c=a[0],s=a[1],p=De(c,r),d=Object(l.a)(p,2),f=d[0],j=d[1];return[f,[].concat(Object(u.a)(s),Object(u.a)(j))]}function De(e,t){var n=t;return[e.flatMap((function(e){var t=Ce(e,n),o=Object(l.a)(t,2),r=o[0],i=o[1];return n=i,r})),n]}var Pe={transform:De,compose:function(e,t){return[].concat(Object(u.a)(e),Object(u.a)(t))},apply:function(e,t){return Te(e,t.length).apply(t)}},We=Object(p.a)({wrapper:{width:"940px",margin:"20px auto"},header:{margin:"0 0 40px",textAlign:"center","& abbr":{textDecorationStyle:"dotted",textDecorationColor:"#aaa",textDecorationThickness:"2px"}}}),Fe=function(e,t){var n=function(e){var t=Q(e);return function(n){var o=n.state,r=_(),i=pe();return Object(B.jsxs)("div",{className:Object(S.a)(r.site,i.server),children:[Object(B.jsxs)("h2",{children:[Object(B.jsx)(le.a,{}),"Central Server"]}),Object(B.jsx)("table",{className:i.stateTable,children:Object(B.jsxs)("tbody",{children:[Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{children:"Document:"}),Object(B.jsx)("td",{children:e.renderSnapshot(o.snapshot)})]}),Object(B.jsxs)("tr",{children:[Object(B.jsx)("th",{children:"Operations:"}),Object(B.jsxs)("td",{children:[0===o.operations.length?Object(B.jsx)(B.Fragment,{children:"none yet"}):Object(B.jsx)(B.Fragment,{}),o.operations.map((function(e){return Object(B.jsx)(t,{operation:e,className:i.operationInLog},e.meta.id)}))]})]})]})})]})}}(t),i=ce(t),a={get:function(e){return e.alice},set:function(e,t){return Object(s.a)(Object(s.a)({},e),{},{alice:t})}},c={get:function(e){return e.bob},set:function(e,t){return Object(s.a)(Object(s.a)({},e),{},{bob:t})}};return function(t){var p=t.initialSnapshot,O=Oe(),u=Object(r.useState)((function(){return function(e){var t={toServer:[],fromServer:[],initialSynchronizationState:{status:j.SYNCHRONIZED,serverRevision:0},clientLog:[],snapshot:e};return{alice:t,bob:t,server:{operations:[],snapshot:e}}}(p)})),d=Object(l.a)(u,2),f=d[0],b=d[1],h=function(t,n){return{state:t.get(f),onClientOperation:function(o){b((function(r){return function(e,t,n,o,r){var i=x(e,n.get(t),r,o);return n.set(t,i)}(e,r,t,n,o)}))},onServerReceiveClick:function(){b((function(n){return I(e,n,t)}))},onClientReceiveClick:function(){var n=void 0;return b((function(o){var r=function(e,t,n){var o=R(e,n.get(t)),r=o.newClientState,i=o.transformedReceivedOperationToApply;return{newState:n.set(t,r),transformedReceivedOperationToApply:i}}(e,o,t),i=r.newState,a=r.transformedReceivedOperationToApply;return n=a,i})),n}}};return Object(B.jsxs)("div",{className:O.container,children:[Object(B.jsx)(n,{state:f.server}),Object(B.jsxs)("div",{className:O.clients,children:[Object(B.jsx)(i,Object(s.a)({clientName:o.Alice,className:O.alice},h(a,o.Alice))),Object(B.jsx)(i,Object(s.a)({clientName:o.Bob,className:O.bob},h(c,o.Bob)))]})]})}}(Pe,ye);var Le=function(){var e=We();return Object(B.jsx)(Z,{children:Object(B.jsxs)("div",{className:e.wrapper,children:[Object(B.jsxs)("h1",{className:e.header,children:["Visualization of ",Object(B.jsx)("abbr",{title:"Operational Transformation",children:"OT"})," with a central server"]}),Object(B.jsx)(Fe,{initialSnapshot:"Lorem ipsum"})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(102);c.a.render(Object(B.jsx)(i.a.StrictMode,{children:Object(B.jsx)(Le,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[103,1,2]]]);
//# sourceMappingURL=main.d9e68c9e.chunk.js.map